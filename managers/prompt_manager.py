import streamlit as st
import pandas as pd 
from code_editor import code_editor

class PromptManager:

    class STEEP:
        
        # *** step 1: summary prompt
        step1_prompt = """
        1.請用STEEP(Social.Technology.Economic.Environment.Political)+B(Business and investment)的架構分類分析今天的"重點新聞"，

        STEEP(social.Technology.Economic.Environment.Political)+B(Business and investment)自定義如下
        請記住下分類規則
        - S - Social(社會): 代表社會和文化因素,如人口統計、消費者行為、教育水平、價值觀、生活方式、社會事件、社交媒體相關法規、社交媒體被裁罰、因社會事件而增訂的法規等。
        關鍵字：高齡化、少子化、性別、心裡健康、健康、疾病、癌症、社交媒體相關法規、社交媒體平台審核，相關主題就是Social(社會)類別。
        - T - Technological(科技): 代表科技發展和創新,如新產品、半導體、生技科技、太空科技、研發投入、專利、新興技術、自動化、數位化因科技而增訂的法規等。
        關鍵字：量子計算、雲端、邊緣運算、科技中心、多模態AI模型、計算機、電腦、晶片、人工智慧、智能、數位、通訊、通信、太空、大數據、技術、半導體、Web3、藥物、科技，就是Technological(科技)類別
        - E - Economic(經濟): 經濟代表一定範圍（國家、區域等）內，組織生產、分配、流通、消費活動和關係的系統，通常以貨幣為媒介，以財貨或服务為結果。如總體經濟、景氣、經濟增長、產業薪資、通貨膨脹、失業率、利率、匯率、財政政策，有關一個地區、國貨全球的經濟，**不能出現單一公司的名字**。
        關鍵字：經濟增長、美聯儲、通貨膨脹、失業率、利率、匯率、物價、財政政策、GDP、日幣匯率、台幣匯率、美金匯率、歐元匯率、景氣、勞動基金、勞退、央行、中央銀行、央行總裁、美聯儲主席等關鍵字就是Economic(經濟)類別。
        - E - Environmental(環境): 代表環境和生態因素,如氣候變遷、自然資源、污染、環保法規、綠色經濟等。
        關鍵字：能源、氣候、生物多樣性、再生能源、循環經濟、垃圾建築、碳中和、環境、污染、環保法規、太陽能、水力發電、風力發電等關鍵字就是Environmental(環境)類別。
        - P - Political(政治): 代表政治和法律因素,如政府政策、選舉、政治穩定性、國家安全、國防、國防軍備、國際關係、貿易協定、外交、政治局勢、地緣政治等。
        關鍵字：政治、政府、民主、獨裁、外交、國際關係、國會、政治人物、選舉、戰爭、中共、總統、美國總統、國會、英國工黨、國民黨、民眾黨、民進黨、中國科技制裁等關鍵字就是Political(政治)類別
        - B - Business and investment(投資): 如市場競爭、股票相關、公司產品銷售狀況、公司盈餘、公司虧損、公司財務狀況、公司市值、獲得投資、投資趨勢、商業模式、企業管理、市場法規、投資法規。
        關鍵字：投資、股價、優惠、折扣、營收、銷售額、利潤、財務狀況、財測、公司市值、財年年收入、財報破產、某名人的財富、投資、資金、市場、金融、電商、收購、交易、財務困境等關鍵字就是Business and investment(投資)類別。
        請勿必不要將類別分錯

        產出：
        1. 每則新聞內容"摘要"60-100字
        2. Technological(科技)列出"4-5則"主題不重複的重點內容
        3. **Economic(經濟)列出"1-4則"主題不重複的重點內容，若內容關於央行、美聯儲、通貨膨脹、匯率、利率一定要列舉，優先列舉
        4. Social(社會)、Environmental(環境)、Political(政治)、Business and investment(投資)依序列出"3-4則"”最重要”且主題”不重複”的內容
        5. **必須使用json格式輸出**
        6. Business and investment(投資)主題盡量以重大事件、趨勢為主，分配股息這種就不要列入
        7. **"Economic(經濟)主題當中不能出現單一公司的名稱，不可以出現如以下：
        "亞馬遜計劃在未來十年投資超過1000億美元於數據中心,現在投入更多資金於雲計算和AI基礎設施,而非電子商務倉庫網絡。亞馬遜網絡服務(AWS)正在擴大投資以滿足AI激發的需求。"
        "SK集團宣布SK海力士將投資103兆韓圜強化晶片業務,主要聚焦AI。SK集團計劃通過AI價值鏈提升競爭力,預估2026年稅前盈餘達40兆韓圜。SK集團將在2026年底前投資80兆韓圜,主要聚焦AI和半導體領域。"
        "德州儀器將獲得美國商務部高達16億美元的資金支持,用於建設三個新設施。這筆資金來自美國CHIPS and Science Act,將用於在德州建設兩個工廠和在猶他州建設一個工廠。德州儀器承諾到2029年投資超過180億美元於這些項目,預計創造2000個製造業工作崗位。該公司還預計從美國財政部獲得約60億至80億美元的投資稅收抵免,以及1000萬美元的勞動力發展資金。"
        這類有明確出現公司名稱的新聞則應該放在Business and investment(投資)或是Technological(科技)。這點希望你可以特別注意，因為時常分類錯誤，謝謝你，你很棒！
        8. 類別判斷應該依據整個事件的性質與類別關鍵字多寡
        "拜登政府宣布提供5.04億美元資金支持12個科技中心,這些科技中心分布在俄亥俄州、蒙大拿州、內華達州和佛羅里達州等地。資金將用於支持量子計算、生物製造、鋰電池、電腦晶片、個人化醫療等技術的發展。"
        這個則應該放Technological(科技)類，因提到量子計算、生物製造、鋰電池、電腦晶片、個人化醫療等技術的發展

        "美國商務部將於7月20日禁止銷售莫斯科Kaspersky Labs生產的防毒軟體。此舉發生在拜登總統簽署法律實際上禁止TikTok兩個月後。美國政府禁止使用Kaspersky軟體的理由是國家安全考量。批評者認為這種做法可能破壞開放互聯網的原則。"
        這個應該要放在Political(政治)類，因提到拜登總統、美國政府、國家安全、莫斯科。

        9. 請用 multiclass 的分類法將新聞分類（不是 multilabel）。也就是說，summary 在不同的 STEEP 主題中也不會重複。同一個 Summary 只會出現在 STEEP 中的其中一個。
        10. 依照我輸入的日期作為回傳 json 的 key。我每丟 10 行就會貼一次日期給你以免你忘記。請務必依照我輸入的日期作為 key，不要擅自產生其他日期。
        11. 假若某一日的某個主題並沒有足夠的新聞產生摘要，請回傳 NA 而不要什麼都不回傳。

        ```

        注意事項
        1. 請使用「繁體中文」以JSON格式回答。
        2. 請確實回答正規JSON格式,將遺漏的雙引號確實補上,並針對內容裡的雙引號前面加上\進行轉義。
        3. 內容請不要重複

        **請生成JSON格式文字,並在雙引號前使用反斜線轉義**
        **按照以下範例格式回答**


        # *** Response Schema *** 
        ```
        ((
        "***輸入的日期***": ((
            "Social(社會)": "把同個類別的重點新聞串成一個字串，並用兩個空行符號隔開，且在開頭幫我用數字編號",
            "Technological(科技)": "",
            "Economic(經濟)": "",
            "Environmental(環境)": "",
            "Political(政治)": "",
            "Business and Investment(投資)": ""
        ))
        ))
        ```

        假若沒有足夠的「經濟」相關新聞：
        ```
        ((
        "***輸入的日期***": ((
            "Social(社會)": "把同個類別的重點新聞串成一個字串，並用兩個空行符號隔開，且在開頭幫我用數字編號",
            "Technological(科技)": "把同個類別的重點新聞串成一個字串，並用兩個空行符號隔開，且在開頭幫我用數字編號",
            "Economic(經濟)": "NA",
            "Environmental(環境)": "把同個類別的重點新聞串成一個字串，並用兩個空行符號隔開，且在開頭幫我用數字編號",
            "Political(政治)": "把同個類別的重點新聞串成一個字串，並用兩個空行符號隔開，且在開頭幫我用數字編號",
            "Business and Investment(投資)": "把同個類別的重點新聞串成一個字串，並用兩個空行符號隔開，且在開頭幫我用數字編號"
        ))
        ))
        ```
        **按照以上範例JSON格式回答，不要亂加子標題**
        **請確實針對內容裡的雙引號前面加上\進行轉義**
        **請注意字典的 key 必須要與我輸入的 key 完全一樣，大小寫也要一樣**
        """

        # *** step 2: three versions trend report
        def step2_prompt(topic, ver):
            return f"""先審視完全部原文，假設你是一位產業分析師、政策制定人員,只基於文中實際提到的內容做以下產出：
            1. 請從我給你的每月新聞中列出4-7個"不同"事件[彼此之間有很高度關聯（事件層次關聯）]、[與該[{topic}]緊密相關的趨勢]的代表事件，"每個事件請列出完整原文"
            2. 針對剛剛分類完的類似、有關連的一組事件”歸納”趨勢"摘要"標題趨勢標題"8-13"字，趨勢摘要標題要”不可以太概略”，每個趨勢摘要標題都要4-7個與趨勢標題高度關聯的事件佐證支持該趨勢摘要標題，
            但是記住”千萬不要過度推論”，只根據事實來歸納趨勢。
            3. [代表事件][趨勢標題]為一組，產生多組趨勢標題。***趨勢標題的數量不要超過 10 組且「至少要有 6 組」。***經濟類標題可以稍微少一點（4 - 5）
            4. 請幫我照順序編號趨勢，不要跳號！

            5. "趨勢標題"及"代表事件"要符合[{topic}]主題維度，請參考以下標準:
            - S - Social(社會): 代表社會和文化因素,如人口統計、消費者行為、教育水平、價值觀、生活方式、社會事件、社交媒體相關法規、社交媒體被裁罰、因社會事件而增訂的法規等。
            關鍵字：高齡化、少子化、性別、心裡健康、健康、疾病、癌症、社交媒體相關法規、社交媒體平台審核，相關主題就是Social(社會)類別。
            - T - Technological(科技): 代表科技發展和創新,如新產品、半導體、生技科技、太空科技、研發投入、專利、新興技術、自動化、數位化因科技而增訂的法規等。
            關鍵字：量子計算、雲端、邊緣運算、科技中心、多模態AI模型、計算機、電腦、晶片、人工智慧、智能、數位、通訊、通信、太空、大數據、技術、半導體、Web3、藥物、科技，就是Technological(科技)類別
            - E - Economic(經濟): 經濟代表一定範圍（國家、區域等）內，組織生產、分配、流通、消費活動和關係的系統，通常以貨幣為媒介，以財貨或服务為結果。如總體經濟、景氣、經濟增長、產業薪資、通貨膨脹、失業率、利率、匯率、財政政策，有關一個地區、國貨全球的經濟，**不能出現單一公司的名字**。
            關鍵字：經濟增長、美聯儲、通貨膨脹、失業率、利率、匯率、物價、財政政策、GDP、日幣匯率、台幣匯率、美金匯率、歐元匯率、景氣、勞動基金、勞退、央行、中央銀行、央行總裁、美聯儲主席等關鍵字就是Economic(經濟)類別。
            - E - Environmental(環境): 代表環境和生態因素,如氣候變遷、自然資源、污染、環保法規、綠色經濟等。
            關鍵字：能源、氣候、生物多樣性、再生能源、循環經濟、垃圾建築、碳中和、環境、污染、環保法規、太陽能、水力發電、風力發電等關鍵字就是Environmental(環境)類別。
            - P - Political(政治): 代表政治和法律因素,如政府政策、選舉、政治穩定性、國家安全、國防、國防軍備、國際關係、貿易協定、外交、政治局勢、地緣政治等。
            關鍵字：政治、政府、民主、獨裁、外交、國際關係、國會、政治人物、選舉、戰爭、中共、總統、美國總統、國會、英國工黨、國民黨、民眾黨、民進黨、中國科技制裁等關鍵字就是Political(政治)類別
            - B - Business and investment(投資): 如市場競爭、股票相關、公司產品銷售狀況、公司盈餘、公司虧損、公司財務狀況、公司市值、獲得投資、投資趨勢、商業模式、企業管理、市場法規、投資法規。
            關鍵字：投資、股價、優惠、折扣、營收、銷售額、利潤、財務狀況、財測、公司市值、財年年收入、財報破產、某名人的財富、投資、資金、市場、金融、電商、收購、交易、財務困境等關鍵字就是Business and investment(投資)類別。
            請勿必不要將類別分錯

            注意事項：
            0. [趨勢標題]記得幫我編號（主要趨勢1，主要趨勢2...），千萬千萬「不要跳號」。(非常重要)
            1. 請參考後面的範例，格式要一樣或類似
            2. 代表事件一定要來自我給你的檔案
            3. ***請用JSON格式回答，請用繁體中文回答，"趨勢標題"、"代表事件"不要改成別的字或改成英文
            4. **"同個趨勢標題"下的代表事件"不能重複"
            5. **有較多代表事件的趨勢標題優先列出
            6. 趨勢標題要能夠概括表達代表事件所形成的趨勢
            7. 標題不可以過度推論要基於事實，並***具體、切中要害、精準分析***
            8. *** 重申一次，每個主題至少要有 6 個，至多 10 個趨勢！經濟類可以少於 6 個，但仍要至少給我 4 個趨勢。然後不要跳號！ ***
            9. 格式請遵守範例，不要擅自加不必要的中括號。趨勢報告格式請參照後面 output schema
            10. 若產出內容有引號，請不要用 json 格式的雙引號 " 以免讀取失敗。使用中文大引號「」

            <output schema>：
        ("{topic}-v{ver}":("趨勢標題": "AI驅動下的數據中心擴張加劇碳排放壓力",
            "代表事件"：["Google的溫室氣體排放量在過去五年內激增48%,主要由於支撐AI系統的數據中心擴張。2023年Google的污染量達到1430萬噸碳當量,比2019年基準增加48%,比去年增加13%。Google承諾在2030年達到淨零排放,但強調這個目標極具挑戰性。",
                        "Amazon與Talen Energy達成核能數據中心交易,可直接從Susquehanna核電廠獲得480 MW電力,未來可能升級到960 MW",
                        "ChatGPT等大型語言模型的成功推動了能源需求的增長，AI查詢所需的電力約為傳統Google查詢的10倍"])
        ... 
        )
        **請使用繁體中文回答**"

        額外要注意的點：
        Economic 維度非常複雜，因為經濟是時時刻刻都在改變的。因此，一個月內可能同時會出現景氣好以及不好的狀況，所以下趨勢標題時要注意一下這個特性，
        以「時間上較近，較新」的事件為主。例如：

        趨勢標題「美國就業市場軟化引發經濟衰退擔憂」不過該月有兩則互相矛盾的事件：
        1.美國上週新申請失業救濟金人數增至11個月高點
        2.美國上週初領失業金人數降至23.3萬人
        所以這個標題不夠好。請以比較近的事件為主（根據我給你的日期資料）。
        此外，請以上述範例的 json 格式輸出。請自行將小括號轉成 JSON 的大括號。"""


        # *** step 3: aggregate three vers
        step3_prompt = """
請綜合3次趨勢分析結果,按照以下原則挑選、合併、整理”最具代表性”和”影響力”的趨勢標題

趨勢標題挑選合併整理原則:
1. 綜合3個檔案，幫我列出所有趨勢標題，並且不能重複

2.非常相似的標題（尤其是代表事件完全一樣的），幫我擇一留下較能含括代表事件的趨勢標題;
代表事件不完全一樣但是標題非常類似，幫我結合兩者，用一個更合適的標題取代，刪除原本的標題
但不要過度合併，盡量涵蓋多種趨勢

3.整合過後每個主題一樣要有 6 - 10 個標題，並且照順序編號，不要跳號！（經濟類可以 4 - 5 即可）

4. 按代表性”和”影響力”排序趨勢標題
基準：有非常具體且重要影響的優先。其次再以數量為基準

5. 對於[趨勢標題],參考代表事件，生成一個200字左右的趨勢洞察,提煉出該趨勢的核心特點和影響。

6. 從以下文本中提取12-20個與[趨勢標題]相關的關鍵字Hashtag

注意事項
1. 請使用繁體中文以JSON格式回答。
2. 請確實回答正規JSON格式,將遺漏的雙引號確實補上,並針對內容裡的雙引號前面加上\進行轉義。
3. 內容請不要重複
4. 想像你是要解釋這個趨勢給一位門外漢聽，因此趨勢洞察的部份請用淺顯易懂的方式描述，不要使用過長的句子或是過於艱深的字彙。
5. 主要趨勢後面的數字請照順序，不要跳號！很重要。

**請確實針對內容裡的雙引號前面加上反斜線\進行轉譯**
範例
(
"主要趨勢1": (
    "標題": "",
    "<a>趨勢洞察": "",
    "<b>Hashtag關鍵詞": []
),
"主要趨勢2": (
),
"主要趨勢3": (
),
"主要趨勢4": (
),
"主要趨勢5": (
),
"主要趨勢6": (
)
)
```
請將遺漏的"雙引號"確實補上,並針對內容裡的雙引號前面加上\\進行轉譯。
**請自行將小括號轉成 JSON 的大括號。**
            """


        # *** step 4: map events (news) back to each trend
        step4_prompt = """
        請根據我所提供的趨勢摘要(json格式)，將summary檔案中對應的[代表事件]歸類到該趨勢下面,代表事件和趨勢標題要具高度關聯性 ，
        對每個趨勢各對應3-6個最具啟發性的[代表事件]，並簡要分析其意義，每則代表事件加分析至少要30字，不超過45字，在每則代表事件及分析後面幫我括號（代表事件從summary檔案來源的對應新聞）

        此外，根據我所提供的[趨勢標題]與[代表事件]，幫我做以下判斷
        1. [趨勢標題]的關鍵字要出現在代表事件或是其來源中，或是類似意思的字也可以。若沒有則幫把該代表事件”字體加粗”
        2. 幫我標註每個代表事件與趨勢標題的關聯度，標住在來源下方，若關聯度低於80%則幫我把該代表事件”字體加粗”
        3. 來源的部份不要只寫日期。標題也要打出來！

        注意事項
        1. 請使用「繁體中文」按照<範例>格式，以JSON格式回答。
        2. 請確實回答正規JSON格式,將遺漏的雙引號確實補上,並針對內容裡的雙引號前面加上\進行轉義。
        3. 內容請不要重複
        4. 選擇事件前請先審核事件來源的敘述是否足夠客觀。如果事件為特定人士的「觀點」或「個人經驗」的話，就不要選擇那個事件。例如：

        「作者身為老年醫學專家，常面對長輩表達厭世情緒的情況。」家屬常因不了解長輩對生命末期的意願而感到困惑。作者認為死亡不應是禁忌話題，
        家人應該能夠坦誠討論。書中描述失智症患者邁向死亡的過程，展現了相愛與相知的重要性。作者呼籲提早討論生命末期意願，並強調理解失智症患者的重要性。

        引號中的句子是某書作者的觀點與經驗，因此不是一個客觀描述總體社會趨勢的事件，所以不要選擇這則。

        另一個例子：「專家認為…」，「學者提到…」等等詞彙有出現的來源，不夠客觀，建議不要採用。

        例如：
        在趨勢「各國加強對中國科技和經濟影響力的限制」下，
        事件「美國司法部對輝達展開兩項反壟斷調查,涉及其AI業務。」就不應被選擇，因為輝達（NVIDIA）是美國的公司。

        5. Economic 維度非常複雜，因為經濟是時時刻刻都在改變的。因此，一個月內可能同時會出現景氣好以及不好的狀況，所以下趨勢標題時要注意一下這個特性，
        以「時間上較近，較新」的事件為主。

        6. 代表事件的「分析」部份，請基於代表事件來源新聞中的「事實」，不要過度推論。前幾個版本時常出現這個問題，希望你可以改進，你做的很好！

        7. 務必標示清楚來源！不要寫「無資料」，找不到的事件就不要放進去。

        8. 子項目前面標上英文字母，你有時候會漏掉。ex: <a>趨勢洞察, <b>Hashtag關鍵詞

        **請確實針對內容裡的雙引號前面加上反斜線\進行轉義**
        **請自行將小括號轉成 JSON 的大括號。**
        ```
        <範例>(主要趨勢請參考此範例)
        ((
        "主要趨勢1": ((
        "標題": "趨勢標題",
        "<a>趨勢洞察": "趨勢的詳細分析",
        "<b>Hashtag關鍵詞": ["#關鍵詞1", "#關鍵詞2".....],
        "<c>代表事件": [((
        "事件": "代表事件1",
        "分析": "事件1的分析",
        "(來源"："summary檔案來源的對應新聞)",
        "關聯度": "0-100%"
        ))],
        ))
        ))
        
        """

        # *** step 5: generate detailed inference
        step5_prompt_1 = '''
        請根據我所提供的趨勢摘要(json格式檔案)，延伸 <d> ~ <j>（在範例當中有詳細說明） ，對每個主題進行[重要關係人]分析，列舉推動[趨勢標題]的關鍵人物或組織所代表的角色類型,
        包括供給端和需求端，深度剖析[趨勢標題]在技術、產品、市場、法規、商業模式等方面存在的至少3個不足和缺口，指出至少3個具體的[產品或服務機會點]。從政治、經濟、社會、技術、商業等角度,分析推動[趨勢標題]發展的至少3個深層次、持續[關鍵驅動因素]，列舉至少3個[趨勢標題]高度相關的[信號識別]，主要為先兆性事件、現象或數據，最後進行[趨勢總結洞察]，為[趨勢標題]生成一個300字以上的[總結洞察]。[總結洞察]包括:判斷該趨勢屬於短期、中期還是長期趨勢,並說明理由，
        指出關鍵機遇與挑戰，提出建設性因應建議(可從國家、產業、企業等層面)，大膽想像未來3-10年的顛覆性進展

        詳細說明以及字數要求：(每一向描述都要足夠具體、精準分析)
        1. 每項[缺口]要"15-28"字。議題缺口請精準對應到趨勢，而「不是」一個定義太廣泛的或是已經存在的問題。例如：

        曾經在「主要趨勢2：AI技術在企業產品和服務中廣泛應用 」下，你找出了以下缺口：
        -AI技術的可解釋性和透明度不足
        -AI應用的安全性和隱私保護有待加強
        -AI人才供給與市場需求存在差距
        -AI技術在特定領域的應用深度不足
        不過這些缺口並沒有非常扣合該趨勢，而且講的多半是「已經存在的問題」，所以不太合適。

        2. 每項未來產品或服務機會點要"18-28"字
        3. 每項關鍵驅動因素"18-28"字，並且以「質化」，「大方向」的敘述為主。
        4. 每項微弱信號"18-28"字，可以是先兆性事件、現象、以及指標。不需要提供實質數據，只要告訴我你認為哪些指標或現象可能與這個趨勢有關。
        5. 趨勢洞察, 趨勢總結洞察的部份，想像你是要解釋這個趨勢給一位門外漢聽，因此趨勢洞察的部份請用淺顯易懂的方式描述，不要使用過長的句子或是過於艱深的字彙。
        6. 時間尺度的部份，請依據「以下標準」，以及「該議題的發展歷史」進行判斷，並在後面括號補充對應的時間長度：
        - 極短期：1 年以內（政治相關事件等等）
        - 短期：1 - 3 年
        - 中期：3 - 5 年
        - 中長期：5 - 10 年
        - 長期：10 年以上
        輸出格式舉例：
        ((..."<i>時間尺度": "短期（1-3年）",
        ...))
        7. 代表事件請列舉所有輸入資料中的事件。

        所謂「該議題的發展歷史」，我舉一個例子：
        性別平等議題的發展歷史已經長達百年，綜觀現今社會的性別多元化趨勢，更偏向一個長期的趨勢。


        注意事項
        1. 請使用「繁體中文」按照<範例>格式，以JSON格式回答。
        2. 請先判斷我提供的data趨勢是"主要"還是"次要"。
        3. 請確實回答正規JSON格式,將遺漏的雙引號確實補上,並針對內容裡的雙引號前面加上\進行轉義。
        4. 內容請不要重複
        5. 子項目前面標上英文字母，你有時候會漏掉。ex: <a>趨勢洞察, <b>Hashtag關鍵詞
        6. **請自行將小括號轉成 JSON 的大括號。**
        '''

        step5_prompt_example = '''
        <範例>
        ((
        "主要趨勢1": ((
            "標題": "趨勢標題",
            "<a>趨勢洞察": "趨勢的詳細分析",
            "<b>Hashtag關鍵詞": ["#關鍵詞1", "#關鍵詞2"],
            "<c>代表事件": [((
                "事件": "代表事件1",
                "分析": "事件1的分析"
                "(來源"："summary檔案來源的對應新聞)"
                "關聯度": "＃%"
            ))],
        "<d>重要關係人": ((
                "供給端": "",
                "需求端": "",
                "代表性意義": ""
            )),
            "<e>缺口": [],
            "<f>未來產品或服務機會點": [],
            "<g>關鍵驅動因素": ((
            "a社會": "社會驅動因素描述",
            "b政治": "政治驅動因素描述",
            "c經濟": "經濟驅動因素描述",
            "d文化": "文化驅動因素描述"
            )),
            "<h>微弱信號": ["信號1", "信號2"],
            "<i>時間尺度": "極短，短期，中期，中長期，或是長期的其中一個。你幫我根據趨勢標題分析該趨勢的時間尺度",
            "<j>趨勢總結洞察": "這是一個趨勢總結洞察，應該以文章形式回答，不自行換行"
        ))
        '''
        
        step5_prompt = step5_prompt_1 + step5_prompt_example

        # *** step 6: conclude the trend report
        # todo:: allow customized length of output text
        step6_prompt ="""
        針對各主題幫我依照以下對應主題的定義進行趨勢分析：
        - S - Social(社會): 代表社會和文化因素,如人口統計、消費者行為、教育水平、價值觀、生活方式、社會事件、社交媒體相關法規、社交媒體被裁罰、因社會事件而增訂的法規等。
        關鍵字：高齡化、少子化、性別、心裡健康、健康、疾病、癌症、社交媒體相關法規、社交媒體平台審核，相關主題就是Social(社會)類別。
        - T - Technological(科技): 代表科技發展和創新,如新產品、半導體、生技科技、太空科技、研發投入、專利、新興技術、自動化、數位化因科技而增訂的法規等。
        關鍵字：量子計算、雲端、邊緣運算、科技中心、多模態AI模型、計算機、電腦、晶片、人工智慧、智能、數位、通訊、通信、太空、大數據、技術、半導體、Web3、藥物、科技，就是Technological(科技)類別
        - E - Economic(經濟): 經濟代表一定範圍（國家、區域等）內，組織生產、分配、流通、消費活動和關係的系統，通常以貨幣為媒介，以財貨或服务為結果。如總體經濟、景氣、經濟增長、產業薪資、通貨膨脹、失業率、利率、匯率、財政政策，有關一個地區、國貨全球的經濟，**不能出現單一公司的名字**。
        關鍵字：經濟增長、美聯儲、通貨膨脹、失業率、利率、匯率、物價、財政政策、GDP、日幣匯率、台幣匯率、美金匯率、歐元匯率、景氣、勞動基金、勞退、央行、中央銀行、央行總裁、美聯儲主席等關鍵字就是Economic(經濟)類別。
        - E - Environmental(環境): 代表環境和生態因素,如氣候變遷、自然資源、污染、環保法規、綠色經濟等。
        關鍵字：能源、氣候、生物多樣性、再生能源、循環經濟、垃圾建築、碳中和、環境、污染、環保法規、太陽能、水力發電、風力發電等關鍵字就是Environmental(環境)類別。
        - P - Political(政治): 代表政治和法律因素,如政府政策、選舉、政治穩定性、國家安全、國防、國防軍備、國際關係、貿易協定、外交、政治局勢、地緣政治等。
        關鍵字：政治、政府、民主、獨裁、外交、國際關係、國會、政治人物、選舉、戰爭、中共、總統、美國總統、國會、英國工黨、國民黨、民眾黨、民進黨、中國科技制裁等關鍵字就是Political(政治)類別
        - B - Business and investment(投資): 如市場競爭、股票相關、公司產品銷售狀況、公司盈餘、公司虧損、公司財務狀況、公司市值、獲得投資、投資趨勢、商業模式、企業管理、市場法規、投資法規。
        關鍵字：投資、股價、優惠、折扣、營收、銷售額、利潤、財務狀況、財測、公司市值、財年年收入、財報破產、某名人的財富、投資、資金、市場、金融、電商、收購、交易、財務困境等關鍵字就是Business and investment(投資)類別。
        請勿必不要將類別分錯


        **按照<範例>格式輸出
        1. 請產出一份"250~400字"的趨勢摘要，內容盡量涵蓋該主題中的各種面向與趨勢，不要過度聚焦在單一新聞事件上。
        "半導體產業正面臨地緣政治因素的巨大影響,尤其是在中美科技競爭的背景下。荷蘭政府可能應美國要求,對ASML的中國售後服務施加更多限制,
        這將對全球半導體供應鏈產生深遠影響。ASML作為光刻機領域的龍頭企業,在半導體產業鏈中扮演著關鍵角色。中國曾是ASML的第二大市場,佔其
        總營業額的29%,但現已回落至第三位。這些限制措施可能會影響ASML約20%來自售後服務的營業額。ASML對此表示擔憂,甚至威脅考慮離開荷蘭。
        這一趨勢反映了科技產業正面臨日益複雜的國際政治環境,企業需要在全球化與本土化之間尋求平衡。同時,這也可能加速中國在半導體領域的自主
        研發進程,推動全球半導體產業格局的重塑。對於台灣等半導體產業重鎮而言,這既是挑戰也是機遇,如何在新形勢下保持競爭優勢將成為關鍵。整
        體而言,半導體產業正進入一個充滿不確定性但也蘊含新機遇的時期,產業鏈各環節都需要審慎應對,靈活調整策略。"
        以上文章就不是一個好的摘要，因為過度聚焦在單一公司ASML！

        2. 摘要內容請多講「大方向」，利用你的聰明才智整合並輸出「概念」，不必一一列舉單一事件（我們已經有事件的資料了）。

        3. 採用文章的形式輸出，無須進行換行及分段

        4. 從原文擷取與主題相關且不重複的關鍵字 50-80 個

        5. 想像你是要解釋這個趨勢給一位門外漢聽，因此趨勢洞察的部份請用淺顯易懂的方式描述，不要使用過長的句子或是過於艱深的字彙。

        注意事項:
        - 使用正體中文,「不可使用簡體字」
        - 使用台灣用語,避免中國大陸用語(如賽道、短版、信息、智能、通信、渠道)
        - 缺口、機會點、建議等…要切中趨勢要害,具體到細分領域
        - 嚴格限定在檔案明確提及的事件案例內,不要過度發散


        **請使用反斜線轉義雙引號字符。**
        **趨勢報告無須進行分段及換行**
        **請自行將小括號轉成 JSON 的大括號。**
        <範例>
            ```
            ((
            趨勢報告": "",
            "關鍵字": []
            ))
            """
        st.markdown("""
            <style>
                .stTable tr {
                    height: 200px; # use this to adjust the height
                }
            </style>
        """, unsafe_allow_html=True)
        
        @st.dialog("System Prompt Playground", width = 'large')
        def prompt_editor():

            tab1, tab2, tab3, tab4 = st.tabs(['趨勢報告製作', '事件分類', '後續推論', '最後總整'])
            with tab1:
                p_s3 = st.text_area("請編輯", st.session_state['steep_prompt_3'], height = 500)
            with tab2:
                p_s4 = st.text_area("請編輯", st.session_state['steep_prompt_4'], height = 500)
            with tab3:
                p_s5 = st.text_area("請編輯",st.session_state['steep_prompt_5'], height = 500)
            with tab4:
                p_s6 = st.text_area("請編輯", st.session_state['steep_prompt_6'], height = 500)
            if st.button("點擊儲存"):
                st.session_state['steep_prompt_3'] = p_s3
                st.session_state['steep_prompt_4'] = p_s4
                st.session_state['steep_prompt_5'] = p_s5
                st.session_state['steep_prompt_6'] = p_s6
            if st.button("重置"):
                for key in [f"steep_prompt_{i}" for i in range(3, 7)]:
                    del st.session_state[key]
                st.rerun()

    
    class SELF_SELECT:
        # *** step1: summary prompt
        step1_prompt = lambda keywords, batch: f"""
            ** 請分析我輸入的一批新聞，統整成"重點新聞" **

            產出：每則新聞內容"摘要"60-100字
            ```
            注意事項
            1. 請使用「繁體中文」以JSON格式回答。
            2. 請確實回答正規JSON格式,將遺漏的雙引號確實補上,並針對內容裡的雙引號前面加上\進行轉義。
            3. 內容請不要重複

            **請生成JSON格式文字,並在雙引號前使用反斜線轉義**
            **按照以下範例格式回答**


            # *** Response Schema *** 
            ```
            (
                "Batch {batch}": (
                    "重點新聞摘要": ["***把重點新聞存成一個 list，且在開頭幫我用數字編號***"]
                )
            )

            ```
            **按照以上範例JSON格式回答，不要亂加子標題**
            **請確實針對內容裡的雙引號前面加上\進行轉義**
            **以上小括號請自行轉義成 json 的大括號**
            **不要亂加換行符號，請用標準的 JSON 格式回傳***
            """
        
        # *** step2: generate three vers trend reports
        step2_prompt = lambda title, ver, additional = "無": f"""先審視完全部原文（每月新聞），假設你是一位產業分析師、政策制定人員,只基於文中實際提到的內容做以下產出：
1. 請從我給你的每月新聞中列出4-7個"不同"事件[彼此之間有很高度關聯（事件層次關聯）]、[與該事件分類群組緊密相關的趨勢]的代表事件，"每個事件請列出完整原文"
2. 針對剛剛分類完的類似、有關連的一組事件”歸納”趨勢"摘要"標題趨勢標題"8-13"字，趨勢摘要標題要”不可以太概略”，每個趨勢摘要標題都要4-7個與趨勢標題高度關聯的事件佐證支持該趨勢摘要標題，
但是記住”千萬不要過度推論”，只根據事實來歸納趨勢。
3. [代表事件][趨勢標題]為一組，產生多組趨勢標題。「至少要有 10 組趨勢，至多 12 組。」

注意事項：
0. [趨勢標題]記得幫我編號（主要趨勢1，主要趨勢2...），千萬千萬「不要跳號」。(非常重要)
1. 請參考後面的範例，格式要一樣或類似
2. 代表事件一定要來自我給你的檔案
3. ***請用JSON格式回答，請用繁體中文回答，"趨勢標題"、"代表事件"不要改成別的字或改成英文
4. **"同個趨勢標題"下的代表事件"不能重複"
5. **有較多代表事件的趨勢標題優先列出
6. 趨勢標題要能夠概括表達代表事件所形成的趨勢
7. 標題不可以過度推論要基於事實，並***具體、切中要害、精準分析***
8. 趨勢的數量請務必不要太少。至少要有 10 組趨勢！！
9. 趨勢內容請聚焦給定主題，顆粒度扣合該主題的核心概念，不要過度泛化。例如，如果我的主題是「邊緣 AI」，請不要都講 AI 相關的趨勢（過度泛化），多講一點「邊緣 AI」相關的趨勢。

# 其他重要指示：
{additional}

範例：
("{title}-v{ver}":("趨勢標題": "AI驅動下的數據中心擴張加劇碳排放壓力",
      "代表事件"：["Google的溫室氣體排放量在過去五年內激增48%,主要由於支撐AI系統的數據中心擴張。2023年Google的污染量達到1430萬噸碳當量,比2019年基準增加48%,比去年增加13%。Google承諾在2030年達到淨零排放,但強調這個目標極具挑戰性。",
                  "Amazon與Talen Energy達成核能數據中心交易,可直接從Susquehanna核電廠獲得480 MW電力,未來可能升級到960 MW",
                  "ChatGPT等大型語言模型的成功推動了能源需求的增長，AI查詢所需的電力約為傳統Google查詢的10倍"])
... 
)
**請使用繁體中文回答**"

額外要注意的點：
Economic 維度非常複雜，因為經濟是時時刻刻都在改變的。因此，一個月內可能同時會出現景氣好以及不好的狀況，所以下趨勢標題時要注意一下這個特性，
以「時間上較近，較新」的事件為主。例如：

趨勢標題「美國就業市場軟化引發經濟衰退擔憂」不過該月有兩則互相矛盾的事件：
1.美國上週新申請失業救濟金人數增至11個月高點
2.美國上週初領失業金人數降至23.3萬人
所以這個標題不夠好。請以比較近的事件為主（根據我給你的日期資料）。
此外，請以上述範例的 json 格式輸出。上面範例中的小括號自己改成大括號。
"""

        # *** step3: aggregate three versions
        step3_prompt = lambda additional = "無": f"""
    請綜合3次趨勢分析結果,按照以下原則挑選、合併、整理”最具代表性”和”影響力”的趨勢標題

趨勢標題挑選合併整理原則:
1. 綜合3個檔案，幫我列出所有趨勢標題，並且不能重複

2.非常相似的標題（尤其是代表事件完全一樣的），幫我擇一留下較能含括代表事件的趨勢標題;
代表事件不完全一樣但是標題非常類似，幫我結合兩者，用一個更合適的標題取代，刪除原本的標題
但不要過度合併，盡量涵蓋多種趨勢

3. 筒正過後的標題請取的簡潔有利一點

4. 按代表性”和”影響力”排序趨勢標題
基準：有非常具體且重要影響的優先。其次再以數量為基準

5. 對於[趨勢標題],參考代表事件，生成一個200字左右的趨勢洞察,提煉出該趨勢的核心特點和影響。

6. 從以下文本中提取12-20個與[趨勢標題]相關的關鍵字Hashtag

7. 結合完的趨勢個數至少要有 10 個

# 其他重要指示：
{additional}

注意事項
1. 請使用繁體中文以JSON格式回答。
2. 請確實回答正規JSON格式,將遺漏的雙引號確實補上,並針對內容裡的雙引號前面加上\進行轉義。
3. 內容請不要重複
4. 想像你是要解釋這個趨勢給一位門外漢聽，因此趨勢洞察的部份請用淺顯易懂的方式描述，不要使用過長的句子或是過於艱深的字彙。

    **請確實針對內容裡的雙引號前面加上反斜線\進行轉譯**
    範例
    ((
    "主要趨勢1": ((
        "標題": "",
        "<a>趨勢洞察": "",
        "<b>Hashtag關鍵詞": []
    ((,
    "主要趨勢2": ((
    )),
    ))
    ```
    請將遺漏的"雙引號"確實補上,並針對內容裡的雙引號前面加上\\進行轉譯。
    最後，上述的小括號請自己改成大括號。
    """

        # *** step4: classification of events
        step4_prompt = lambda additional = "無": f"""
請根據我所提供的趨勢摘要(json格式)，將summary檔案中對應的[代表事件]歸類到該趨勢下面,代表事件和趨勢標題要具高度關聯性，
對每個趨勢各對應3-6個最具啟發性的[代表事件]，並簡要分析其意義，每則代表事件加分析至少要30字，不超過45字，在每則代表事件及分析後面幫我括號（代表事件從summary檔案來源的對應新聞）

此外，根據我所提供的[趨勢標題]與[代表事件]，幫我做以下判斷
  1. [趨勢標題]的關鍵字要出現在代表事件或是其來源中，或是類似意思的字也可以。若沒有則幫把該代表事件”字體加粗”
  2. 幫我標註每個代表事件與趨勢標題的關聯度，標住在來源下方，若關聯度低於80%則幫我把該代表事件”字體加粗”
  3. 來源的部份不要只寫日期。標題也要打出來！

注意事項
1. 請使用「繁體中文」按照<範例>格式，以JSON格式回答。
2. 請確實回答正規JSON格式,將遺漏的雙引號確實補上,並針對內容裡的雙引號前面加上\進行轉義。
3. 內容請不要重複
4. 選擇事件前請先審核事件來源的敘述是否足夠客觀。如果事件為特定人士的「觀點」或「個人經驗」的話，就不要選擇那個事件。例如：

「作者身為老年醫學專家，常面對長輩表達厭世情緒的情況。」家屬常因不了解長輩對生命末期的意願而感到困惑。作者認為死亡不應是禁忌話題，
家人應該能夠坦誠討論。書中描述失智症患者邁向死亡的過程，展現了相愛與相知的重要性。作者呼籲提早討論生命末期意願，並強調理解失智症患者的重要性。

引號中的句子是某書作者的觀點與經驗，因此不是一個客觀描述總體社會趨勢的事件，所以不要選擇這則。

另一個例子：「專家認為…」，「學者提到…」等等詞彙有出現的來源，不夠客觀，建議不要採用。

例如：
在趨勢「各國加強對中國科技和經濟影響力的限制」下，
事件「美國司法部對輝達展開兩項反壟斷調查,涉及其AI業務。」就不應被選擇，因為輝達（NVIDIA）是美國的公司。

5. Economic 維度非常複雜，因為經濟是時時刻刻都在改變的。因此，一個月內可能同時會出現景氣好以及不好的狀況，所以下趨勢標題時要注意一下這個特性，
以「時間上較近，較新」的事件為主。

6. 代表事件的「分析」部份，請基於代表事件來源新聞中的「事實」，不要過度推論。前幾個版本時常出現這個問題，希望你可以改進，你做的很好！

7. JSON 的 key 請嚴格遵守範例，不要亂改。

8. [報告中的趨勢數量必須要有至少 10 個]

9. 事件來源，只需要寫事件的標題，「不需要」註明 batch 編號。也不要填寫「無資料」，因為如果真的沒資料就代表你在憑空捏造事件。

10. 每個欄位前面的英文標號（<a...> <b...>）請確實寫上！

**請確實針對內容裡的雙引號前面加上反斜線\進行轉義**

```
<範例>(主要趨勢請參考此範例)
(
"主要趨勢1": (
"標題": "趨勢標題",
"<a>趨勢洞察": "趨勢的詳細分析",
"<b>Hashtag關鍵詞": ["#關鍵詞1", "#關鍵詞2".....],
"<c>代表事件": [(
"事件": "代表事件1",
"分析": "事件1的分析",
"(來源"："總整我輸入的檔案來源中的對應新聞。",
"關聯度": "0-100%"
)],
)
)

** 請自己把上面小括號改成大括號 **

# 其他重要指示：
{additional}
"""

        # *** step5: inference
        step5_prompt = lambda cols, additional: f'''
請根據我所提供的趨勢摘要(json格式檔案)以及我的需求，延伸 <d> ~ <j>（在範例當中有詳細說明） ，對每個主題進行[重要關係人]分析，列舉推動[趨勢標題]的關鍵人物或組織所代表的角色類型,
包括供給端和需求端，深度剖析[趨勢標題]在技術、產品、市場、法規、商業模式等方面存在的至少3個不足和缺口，指出至少3個具體的[產品或服務機會點]。從政治、經濟、社會、技術、商業等角度,分析推動[趨勢標題]發展的至少3個深層次、持續[關鍵驅動因素]，列舉至少3個[趨勢標題]高度相關的[信號識別]，主要為先兆性事件、現象或數據，最後進行[趨勢總結洞察]，為[趨勢標題]生成一個300字以上的[總結洞察]。[總結洞察]包括:判斷該趨勢屬於短期、中期還是長期趨勢,並說明理由，
指出關鍵機遇與挑戰，提出建設性因應建議(可從國家、產業、企業等層面)，大膽想像未來3-10年的顛覆性進展。並不是每項推論都會請你做，後續會在給你指示。

詳細說明以及字數要求：(每一向描述都要足夠具體、精準分析)
1. 每項[缺口]要"15-28"字。議題缺口請精準對應到趨勢，而「不是」一個定義太廣泛的或是已經存在的問題。例如：

曾經在「主要趨勢2：AI技術在企業產品和服務中廣泛應用 」下，你找出了以下缺口：
-AI技術的可解釋性和透明度不足
-AI應用的安全性和隱私保護有待加強
-AI人才供給與市場需求存在差距
-AI技術在特定領域的應用深度不足
不過這些缺口並沒有非常扣合該趨勢，而且講的多半是「已經存在的問題」，所以不太合適。

2. 每項未來產品或服務機會點要"18-28"字
3. 每項關鍵驅動因素"18-28"字，並且以「質化」，「大方向」的敘述為主。
4. 每項微弱信號"18-28"字，可以是先兆性事件、現象、以及指標。不需要提供實質數據，只要告訴我你認為哪些指標或現象可能與這個趨勢有關。
5. 趨勢洞察, 趨勢總結洞察的部份，想像你是要解釋這個趨勢給一位門外漢聽，因此趨勢洞察的部份請用淺顯易懂的方式描述，不要使用過長的句子或是過於艱深的字彙。
6. 時間尺度的部份，請依據「以下標準」，以及「該議題的發展歷史」進行判斷，並在後面括號補充對應的時間長度：
- 極短期：1 年以內（政治相關事件等等）
- 短期：1 - 3 年
- 中期：3 - 5 年
- 中長期：5 - 10 年
- 長期：10 年以上
輸出格式舉例：
(..."<i>時間尺度": "短期（1-3年）",
...)
7. 代表事件請列舉所有輸入資料中的事件。
8. 因為我有資料標準化的需求，每個欄位前面的英文標號（<a...> <b...>）請確實寫上！

所謂「該議題的發展歷史」，我舉一個例子：
性別平等議題的發展歷史已經長達百年，綜觀現今社會的性別多元化趨勢，更偏向一個長期的趨勢。


注意事項
1. 請使用「繁體中文」按照<範例>格式，以JSON格式回答。
2. 請先判斷我提供的data趨勢是"主要"還是"次要"。
3. 請確實回答正規JSON格式,將遺漏的雙引號確實補上,並針對內容裡的雙引號前面加上\進行轉義。
4. 內容請不要重複
5. **請自行將小括號轉成 JSON 的大括號。**

<範例>
(
  "主要趨勢1": (
    "標題": "趨勢標題",
    "<a>趨勢洞察": "趨勢的詳細分析",
    "<b>Hashtag關鍵詞": ["#關鍵詞1", "#關鍵詞2"],
    "<c>代表事件": [(
        "事件": "代表事件1",
        "分析": "事件1的分析"
        "(來源"："summary檔案來源的對應新聞)"
        "關聯度": "＃%"
    )],
   "<d>重要關係人": (
        "供給端": "",
        "需求端": "",
        "代表性意義": ""
    ),
    "<e>缺口": [],
    "<f>未來產品或服務機會點": [],
    "<g>關鍵驅動因素": (
      "a社會": "社會驅動因素描述",
      "b政治": "政治驅動因素描述",
      "c經濟": "經濟驅動因素描述",
      "d文化": "文化驅動因素描述"
    ),
    "<h>微弱信號": ["信號1", "信號2"],
    "<i>時間尺度": "極短，短期，中期，中長期，或是長期的其中一個。你幫我根據趨勢標題分析該趨勢的時間尺度",
    "<j>趨勢總結洞察": "這是一個趨勢總結洞察，應該以文章形式回答，不自行換行"
  )
  

***** 這次推論只需要請你推論以下部份：<a>趨勢洞察, <b>Hashtag關鍵詞, <c>代表事件, <d>重要關係人, <e>缺口, {cols}。其他部份可以忽略不做。輸出格式請一樣用 well-formatted JSON *****
***** 其他額外指示：
{additional}。
麻煩你了！
'''

        # *** step6: conclusion
        step6_prompt = lambda additional = "無": f"""
針對各主題幫我依照以下對應主題的定義進行趨勢分析：
- S - Social(社會): 代表社會和文化因素,如人口統計、消費者行為、教育水平、價值觀、生活方式、社會事件、社交媒體相關法規、社交媒體被裁罰、因社會事件而增訂的法規等。
關鍵字：高齡化、少子化、性別、心裡健康、健康、疾病、癌症、社交媒體相關法規、社交媒體平台審核，相關主題就是Social(社會)類別。
- T - Technological(科技): 代表科技發展和創新,如新產品、半導體、生技科技、太空科技、研發投入、專利、新興技術、自動化、數位化因科技而增訂的法規等。
關鍵字：量子計算、雲端、邊緣運算、科技中心、多模態AI模型、計算機、電腦、晶片、人工智慧、智能、數位、通訊、通信、太空、大數據、技術、半導體、Web3、藥物、科技，就是Technological(科技)類別
- E - Economic(經濟): 經濟代表一定範圍（國家、區域等）內，組織生產、分配、流通、消費活動和關係的系統，通常以貨幣為媒介，以財貨或服务為結果。如總體經濟、景氣、經濟增長、產業薪資、通貨膨脹、失業率、利率、匯率、財政政策，有關一個地區、國貨全球的經濟，**不能出現單一公司的名字**。
關鍵字：經濟增長、美聯儲、通貨膨脹、失業率、利率、匯率、物價、財政政策、GDP、日幣匯率、台幣匯率、美金匯率、歐元匯率、景氣、勞動基金、勞退、央行、中央銀行、央行總裁、美聯儲主席等關鍵字就是Economic(經濟)類別。
- E - Environmental(環境): 代表環境和生態因素,如氣候變遷、自然資源、污染、環保法規、綠色經濟等。
關鍵字：能源、氣候、生物多樣性、再生能源、循環經濟、垃圾建築、碳中和、環境、污染、環保法規、太陽能、水力發電、風力發電等關鍵字就是Environmental(環境)類別。
- P - Political(政治): 代表政治和法律因素,如政府政策、選舉、政治穩定性、國家安全、國防、國防軍備、國際關係、貿易協定、外交、政治局勢、地緣政治等。
關鍵字：政治、政府、民主、獨裁、外交、國際關係、國會、政治人物、選舉、戰爭、中共、總統、美國總統、國會、英國工黨、國民黨、民眾黨、民進黨、中國科技制裁等關鍵字就是Political(政治)類別
- B - Business and investment(投資): 如市場競爭、股票相關、公司產品銷售狀況、公司盈餘、公司虧損、公司財務狀況、公司市值、獲得投資、投資趨勢、商業模式、企業管理、市場法規、投資法規。
關鍵字：投資、股價、優惠、折扣、營收、銷售額、利潤、財務狀況、財測、公司市值、財年年收入、財報破產、某名人的財富、投資、資金、市場、金融、電商、收購、交易、財務困境等關鍵字就是Business and investment(投資)類別。
請勿必不要將類別分錯


**按照<範例>格式輸出
1. 請產出一份"250~400字"的趨勢摘要，內容盡量涵蓋該主題中的各種面向與趨勢，不要過度聚焦在單一新聞事件上。
"半導體產業正面臨地緣政治因素的巨大影響,尤其是在中美科技競爭的背景下。荷蘭政府可能應美國要求,對ASML的中國售後服務施加更多限制,
這將對全球半導體供應鏈產生深遠影響。ASML作為光刻機領域的龍頭企業,在半導體產業鏈中扮演著關鍵角色。中國曾是ASML的第二大市場,佔其
總營業額的29%,但現已回落至第三位。這些限制措施可能會影響ASML約20%來自售後服務的營業額。ASML對此表示擔憂,甚至威脅考慮離開荷蘭。
這一趨勢反映了科技產業正面臨日益複雜的國際政治環境,企業需要在全球化與本土化之間尋求平衡。同時,這也可能加速中國在半導體領域的自主
研發進程,推動全球半導體產業格局的重塑。對於台灣等半導體產業重鎮而言,這既是挑戰也是機遇,如何在新形勢下保持競爭優勢將成為關鍵。整
體而言,半導體產業正進入一個充滿不確定性但也蘊含新機遇的時期,產業鏈各環節都需要審慎應對,靈活調整策略。"
以上文章就不是一個好的摘要，因為過度聚焦在單一公司ASML！

2. 摘要內容請多講「大方向」，利用你的聰明才智整合並輸出「概念」，不必一一列舉單一事件（我們已經有事件的資料了）。

3. 採用文章的形式輸出，無須進行換行及分段

4. 從原文擷取與主題相關且不重複的關鍵字 50-80 個

5. 想像你是要解釋這個趨勢給一位門外漢聽，因此趨勢洞察的部份請用淺顯易懂的方式描述，不要使用過長的句子或是過於艱深的字彙。

6. 每個欄位前面的英文標號（<a...> <b...>）請確實寫上！

注意事項:
- 使用正體中文,「不可使用簡體字」
- 使用台灣用語,避免中國大陸用語(如賽道、短版、信息、智能、通信、渠道)
- 缺口、機會點、建議等…要切中趨勢要害,具體到細分領域
- 嚴格限定在檔案明確提及的事件案例內,不要過度發散




**請使用反斜線轉義雙引號字符。**
**趨勢報告無須進行分段及換行**
<範例>
    ```
    (
    趨勢報告": "",
    "關鍵字": []
    )

** 請自己把上面的小括號換成大括號。**

# 其他重要指示：
{additional}
    """
        
    class Others:
        gen_html_slides = '''
你是一個富有創意且美感的管理顧問，我需要你協助我進行簡報的製作與排版。我相信你的美感，請發揮你 100% 潛能！
我會輸入一個完整的 JSON 格式趨勢報告，內容會包含數個趨勢以及該趨勢的相關事件、微弱信號、相關人分析等等的細節，
但我想要你幫我將此結構轉成 HTML & CSS 格式的網頁式簡報。

舉例：
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>趨勢報告簡報</title>
    <style>
        body {{            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 40px;
            line-height: 1.6;
        }}
        .container {{            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }}
        .keyword {{            display: inline-block;
            background: #ff7f50;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            margin-bottom: 15px;
        }}
        .quote-line {{            border-left: 4px solid #ff7f50;
            padding-left: 15px;
            margin: 10px 0;
        }}
        ul {{            list-style-type: disc;
            padding-left: 20px;
        }}
    </style>
</head>
<body>

<div class="container">
    <div class="keyword">#數位轉型</div>
    <div class="quote-line">
        <p>數位轉型正在改變各行各業，以下是主要趨勢：</p>
    </div>
    <ul>
        <li>AI 與自動化提升生產效率</li>
        <li>數據分析驅動決策</li>
        <li>遠端與混合辦公模式普及</li>
        <li>雲端技術加速企業轉型</li>
    </ul>
</div>

</body>
</html>


可以看到以上 HTML 結構完美地將寶雅的營運報告，用HTML & CSS 的原始碼呈現。我需要你發揮創意，針對我接下來輸出的 JSON 格式內文，產出一份同等（或是更加）美觀的 HTML 簡報。

注意事項：
1. 輸出請使用 json: {{"output": "[成果 HTML & CSS code]"}} 的格式來回傳，請不要回傳其他文字。
2. 輸出必須包含 CSS 選擇器內容，至少變個顏色並讓輸出結果一個區塊一個區塊呈現。
3. 每個 CSS, HTML 區塊之間，請不要有任何換行符號，不然輸出會失敗。
4. 請善用 <li> 標籤來列點，或是善用 <div> 標籤來製作 hashtag 小方格。
5. 請發揮創意排版，不需要完全參照我給的例子。
'''